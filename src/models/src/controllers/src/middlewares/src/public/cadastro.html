<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro e Login</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
      background-color: #f9f9f9;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
    }
    form {
      background: #fff;
      padding: 20px;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      transition: border-color 0.2s ease-in-out;
    }
    input:focus, select:focus {
      border-color: #4CAF50;
      outline: none;
    }
    .hidden-field {
      display: none;
      margin-top: 5px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.2s ease-in-out;
    }
    button:hover {
      background-color: #45a049;
    }
    #mensagem, #mensagemLogin {
      margin-top: 20px;
      padding: 10px;
      border-radius: 4px;
    }
    .loading {
      display: none;
      text-align: center;
      margin-top: 20px;
    }
    .spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border-left-color: #09f;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @media (max-width: 600px) {
      body {
        padding: 10px;
      }
      form {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <h1>Cadastro e Login</h1>
  
  <!-- Cadastro Form oculto -->
  <div id="cadastroForm" style="display:none;">
    <form id="formParticipante">
      <!-- Dados Pessoais -->
      <div class="form-group">
        <label for="nome">Nome completo*</label>
        <input type="text" id="nome" required>
      </div>
      
      <div class="form-group">
        <label for="idade">Idade*</label>
        <input type="number" id="idade" min="0" max="120" required>
      </div>
      
      <div class="form-group">
        <label for="emailCadastro">E-mail*</label>
        <input type="email" id="emailCadastro" required>
      </div>
      
      <div class="form-group">
        <label for="senhaCadastro">Senha*</label>
        <input type="password" id="senhaCadastro" required>
      </div>
      
      <!-- Gênero -->
      <div class="form-group">
        <label for="genero">Gênero*</label>
        <select id="genero" required>
          <option value="">Selecione...</option>
          <option value="Masculino">Masculino</option>
          <option value="Feminino">Feminino</option>
          <option value="Transgênero">Transgênero</option>
          <option value="Não binário">Não binário</option>
          <option value="Outro">Outro</option>
        </select>
        <input type="text" id="generoPersonalizado" class="hidden-field" placeholder="Especifique o gênero">
      </div>
      
      <!-- Raça/Cor -->
      <div class="form-group">
        <label for="racaCor">Raça/cor*</label>
        <select id="racaCor" required>
          <option value="">Selecione...</option>
          <option value="Branco">Branco</option>
          <option value="Preto">Preto</option>
          <option value="Pardo">Pardo</option>
          <option value="Povos originários">Povos originários</option>
        </select>
      </div>
      
      <!-- Escolaridade -->
      <div class="form-group">
        <label for="escolaridade">Escolaridade*</label>
        <select id="escolaridade" required>
          <option value="">Selecione...</option>
          <option value="Ensino fundamental incompleto">Ensino fundamental incompleto</option>
          <option value="Ensino fundamental completo">Ensino fundamental completo</option>
          <option value="Ensino médio incompleto">Ensino médio incompleto</option>
          <option value="Ensino médio completo">Ensino médio completo</option>
          <option value="Graduação incompleta">Graduação incompleta</option>
          <option value="Graduação completa">Graduação completa</option>
          <option value="Prefere não dizer">Prefere não dizer</option>
        </select>
      </div>
      
      <!-- Estado Civil -->
      <div class="form-group">
        <label for="estadoCivil">Estado civil*</label>
        <select id="estadoCivil" required>
          <option value="">Selecione...</option>
          <option value="Casado">Casado</option>
          <option value="Viúvo">Viúvo</option>
          <option value="Divorciado">Divorciado</option>
          <option value="Separado">Separado</option>
          <option value="Solteiro">Solteiro</option>
          <option value="Prefere não dizer">Prefere não dizer</option>
        </select>
      </div>
      
      <!-- Situação de Emprego -->
      <div class="form-group">
        <label for="situacaoEmprego">Situação de emprego*</label>
        <select id="situacaoEmprego" required>
          <option value="">Selecione...</option>
          <option value="Meio período">Meio período</option>
          <option value="Desempregado">Desempregado</option>
          <option value="Incapaz de trabalhar">Incapaz de trabalhar</option>
          <option value="Aposentado">Aposentado</option>
          <option value="Prefere não dizer">Prefere não dizer</option>
          <option value="Outro">Outro</option>
        </select>
        <input type="text" id="empregoPersonalizado" class="hidden-field" placeholder="Especifique a situação">
      </div>
      
      <!-- Benefícios Sociais -->
      <div class="form-group">
        <label for="beneficiosSociais">Recebe algum benefício social?</label>
        <select id="beneficiosSociais" multiple>
          <option value="Nenhum">Nenhum</option>
          <option value="Bolsa Família">Bolsa Família</option>
          <option value="Outros">Outros</option>
        </select>
        <input type="text" id="outrosBeneficios" class="hidden-field" placeholder="Quais outros benefícios?">
      </div>
      
      <!-- Número de Dependentes -->
      <div class="form-group">
        <label for="dependentes">Número de dependentes*</label>
        <select id="dependentes" required>
          <option value="">Selecione...</option>
          <option value="0">Nenhum</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
          <option value="4">4</option>
          <option value="5">5 ou mais</option>
          <option value="-1">Prefere não dizer</option>
        </select>
      </div>
      
      <!-- Religião -->
      <div class="form-group">
        <label for="religiao">Religião*</label>
        <select id="religiao" required>
          <option value="">Selecione...</option>
          <option value="Católico">Católico</option>
          <option value="Evangélico">Evangélico</option>
          <option value="Candomblé">Candomblé</option>
          <option value="Umbanda">Umbanda</option>
          <option value="Espírita">Espírita</option>
          <option value="Nenhum">Nenhum</option>
          <option value="Prefere não dizer">Prefere não dizer</option>
          <option value="Outro">Outro</option>
        </select>
        <input type="text" id="religiaoPersonalizada" class="hidden-field" placeholder="Especifique a religião">
      </div>
      
      <!-- Geolocalização -->
      <input type="hidden" id="latitude" name="latitude">
      <input type="hidden" id="longitude" name="longitude">
      
      <button type="submit">Cadastrar e Ir para Questionário</button>
    </form>
  </div>
  
  <!-- Login Form (único visível) -->
  <div id="loginForm">
    <form id="formLogin">
      <div class="form-group">
        <label for="email">E-mail*</label>
        <input type="email" id="email" required>
      </div>
      <div class="form-group">
        <label for="senha">Senha*</label>
        <input type="password" id="senha" required>
      </div>
      <button type="submit">Entrar</button>
    </form>
    <div id="mensagemLogin"></div>
  </div>
  
  <div class="loading" id="loading">
    <div class="spinner"></div>
    <p>Cadastrando participante...</p>
  </div>
  
  <div id="mensagem"></div>
  
  <script>
    // Solicitar geolocalização (com permissão do usuário)
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          document.getElementById('latitude').value = position.coords.latitude;
          document.getElementById('longitude').value = position.coords.longitude;
        },
        (error) => {
          console.error('Erro ao obter geolocalização:', error);
        }
      );
    } else {
      console.error('Geolocalização não é suportada neste navegador');
    }

    // Mostra campos adicionais quando o botão for clicado
    document.getElementById('btnMaisInfos').addEventListener('click', () => {
      const campos = document.getElementById('camposAdicionais');
      if (campos.classList.contains('hidden')) {
        campos.classList.remove('hidden');
        document.getElementById('btnMaisInfos').textContent = 'Ocultar informações complementares';
      } else {
        campos.classList.add('hidden');
        document.getElementById('btnMaisInfos').textContent = 'Inserir mais informações';
      }
    });
    
    // Envio do cadastro (fluxo simplificado)
    document.getElementById('formCadastro').addEventListener('submit', async function(e) {
      e.preventDefault();
      const cadastroData = {
        nome: document.getElementById('nome').value,
        email: document.getElementById('email').value,
        senha: document.getElementById('senha').value,
        idade: document.getElementById('idade').value,
        genero: document.getElementById('genero').value,
        latitude: document.getElementById('latitude').value,
        longitude: document.getElementById('longitude').value,
        // Campos adicionais somente se visíveis
        racaCor: document.getElementById('camposAdicionais').classList.contains('hidden') ? undefined : document.getElementById('racaCor').value,
        escolaridade: document.getElementById('camposAdicionais').classList.contains('hidden') ? undefined : document.getElementById('escolaridade').value,
        estadoCivil: document.getElementById('camposAdicionais').classList.contains('hidden') ? undefined : document.getElementById('estadoCivil').value,
        situacaoEmprego: document.getElementById('camposAdicionais').classList.contains('hidden') ? undefined : document.getElementById('situacaoEmprego').value,
        dependentes: document.getElementById('camposAdicionais').classList.contains('hidden') ? undefined : document.getElementById('dependentes').value,
        religiao: document.getElementById('camposAdicionais').classList.contains('hidden') ? undefined : document.getElementById('religiao').value
      };
      try {
        const response = await fetch('/participantes', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(cadastroData)
        });
        const text = await response.text();
        const data = text ? JSON.parse(text) : {};
        if(response.ok) {
          document.getElementById('mensagem').textContent = data.message;
          setTimeout(() => {
            window.location.href = '/src/models/src/controllers/src/middlewares/src/public/login.html';
          }, 2000);
        } else {
          throw new Error(data.error || 'Erro no cadastro');
        }
      } catch(error) {
        document.getElementById('mensagem').textContent = 'Erro: ' + error.message;
      }
    });
  </script>
</body>
</html>